# 服务端如何防止重复提交

## 表单重复提交的场景

1. 服务端未能及时响应，导致前端页面没有及时刷新，用户多次提交
2. 用户提价表单成功后再次点击刷新按钮重新提交

## 重复提交表单带来的问题

1. 插入重复的数据

## 解决方案

> 单机、集群版本

1. 前端通过设置标记位进行拦截，在提交的js中处理
2. 前端通过禁用按钮进行拦截
3. 前端页面每次请求时服务端返回该页面一个随机token，前端提交的时候把这个token带到后端，后端来做判断

> 分布式

由于分布式的每次请求打到的服务器都不确定，因此需要一个公共的地方来标识这次请求，常用的解决方案是：在数据提交之前，根据规则生成一个key，然后判断这个key在redis中是否存在，如果不存在，则创建并设置过期时间（加锁），然后表单提交，业务结束释放锁（或者到期自动释放）。key的生成是按照用户维度，比如对请求进行md5计算得到一个值（需要考虑），也可以使用类+方法+token的方式来处理

